<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ³°è‡ªå‹•æ§åˆ¶è¡Œ - é›»å­å ±åƒ¹å–®ç³»çµ±</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; padding: 20px; background-color: #f0f0f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        /* è¼¸å…¥ä»‹é¢æ¨£å¼ */
        input, textarea { border: 1px solid #ddd; padding: 5px; width: 100%; box-sizing: border-box; font-size: 16px; }
        .header-info input { margin-bottom: 5px; }
        
        /* æŒ‰éˆ•æ¨£å¼ (åˆ—å°æ™‚æœƒéš±è—) */
        .no-print { margin-bottom: 20px; padding: 15px; background: #e8f4ff; border-radius: 8px; border: 1px solid #b6d4fe; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; margin-right: 10px; }
        button:hover { background-color: #0056b3; }
        button.delete-btn { background-color: #dc3545; padding: 5px 10px; font-size: 14px; }
        button.clear-sign { background-color: #6c757d; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; vertical-align: middle; }
        th { background-color: #f2f2f2; }
        .text-left { text-align: left; }
        
        /* ç°½åæ¿ */
        #signature-pad { border: 2px dashed #ccc; background: #fffbe6; touch-action: none; cursor: crosshair; }
        
        /* --- å ±åƒ¹å–®å°ˆå±¬æ’ç‰ˆ (ä¾ç…§åŸå§‹ PDF) --- */
        .company-title { font-size: 28px; font-weight: bold; text-align: center; margin-bottom: 10px; text-decoration: underline; }
        .company-details { text-align: center; font-size: 14px; line-height: 1.6; margin-bottom: 20px; }
        .bill-title { font-size: 24px; text-align: center; border: 2px solid #000; display: inline-block; padding: 5px 30px; margin: 0 auto; }
        .bill-title-wrapper { text-align: center; margin: 20px 0; }
        
        .client-section { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: flex-end; }
        .client-info { width: 60%; }
        .date-info { width: 30%; text-align: right; }

        .terms-section { margin-top: 20px; font-size: 14px; }
        .terms-section p { margin: 5px 0; }
        
        .footer-sign { margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
        .sign-box { width: 45%; border-bottom: 1px solid #000; padding-bottom: 5px; }
        .sign-img { max-height: 80px; display: block; }

        /* --- åˆ—å°æ¨¡å¼ (è½‰ PDF æ™‚çš„æ¨£å­) --- */
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; padding: 0; margin: 0; width: 100%; max-width: 100%; }
            .no-print, .delete-btn { display: none !important; }
            input, textarea { border: none; background: transparent; padding: 0; font-family: inherit; resize: none; }
            /* å¼·åˆ¶é¡¯ç¤ºé‚Šæ¡†é¡è‰² */
            th, td { border: 1px solid #000 !important; -webkit-print-color-adjust: exact; }
            #signature-pad { display: none; } /* éš±è—ç•«å¸ƒï¼Œæ”¹é¡¯ç¤ºåœ–ç‰‡ */
            #signature-display { display: block !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h3>æ“ä½œé¢æ¿</h3>
        <p>1. è¼¸å…¥å®¢æˆ¶è³‡æ–™èˆ‡æ˜ç´° -> 2. è«‹å®¢æˆ¶åœ¨ä¸‹æ–¹ç°½å -> 3. é»æ“Šç”Ÿæˆå ±åƒ¹å–®</p>
        <button onclick="addRow()">+ æ–°å¢é …ç›®</button>
        <button onclick="printPDF()">ğŸ–¨ï¸ ç”Ÿæˆå ±åƒ¹å–® (PDF)</button>
    </div>

    <div class="company-title">è‹±æ³°è‡ªå‹•æ§åˆ¶è¡Œ</div>
    <div class="company-details">
        åœ°å€:å½°åŒ–ç¸£å“¡æ—é®å“¡é›†è·¯2æ®µ493å··4å¼„10è™Ÿ<br>
        é›»è©±:04-8356923 &nbsp; å‚³çœŸ:04-8341151<br>
        æ‰‹æ©Ÿ:0935-435757 &nbsp; çµ±ç·¨:45229579
    </div>

    <div class="bill-title-wrapper">
        <div class="bill-title">å ± åƒ¹ å–®</div>
    </div>

    <div class="client-section">
        <div class="client-info">
            TO: <input type="text" placeholder="è¼¸å…¥å®¢æˆ¶åç¨±" value="" style="font-size: 18px; font-weight: bold; width: 80%; display: inline-block; border-bottom: 1px solid #000;">
            <br><br>
            é—œæ–¼: <input type="text" placeholder="ä¾‹å¦‚ï¼šå¯ç¨‹å¼æ§åˆ¶å™¨ä¸€äº‹" value="å¯ç¨‹å¼æ§åˆ¶å™¨ä¸€äº‹" style="width: 80%; border-bottom: 1px solid #000;">
        </div>
        <div class="date-info">
            æ—¥æœŸ: <input type="text" id="dateField" value="">
        </div>
    </div>

    <table id="quoteTable">
        <thead>
            <tr>
                <th style="width: 5%">é …æ¬¡</th>
                <th style="width: 25%">å ç¨±</th>
                <th style="width: 20%">è¦ æ ¼</th>
                <th style="width: 8%">æ•¸é‡</th>
                <th style="width: 12%">å–® åƒ¹</th>
                <th style="width: 15%">ç¸½ åƒ¹</th>
                <th style="width: 10%">å‚™ è¨»</th>
                <th class="no-print" style="width: 5%">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td><input type="text" placeholder="å“å"></td>
                <td><input type="text" placeholder="è¦æ ¼"></td>
                <td><input type="number" class="qty" value="1" oninput="calcTotal(this)"></td>
                <td><input type="number" class="price" placeholder="0" oninput="calcTotal(this)"></td>
                <td><input type="text" class="total" readonly value="0"></td>
                <td><input type="text"></td>
                <td class="no-print"><button class="delete-btn" onclick="deleteRow(this)">åˆª</button></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" style="text-align: right; font-weight: bold;">åˆè¨ˆ:</td>
                <td colspan="2"><input type="text" id="grandTotal" style="text-align: center; font-weight: bold;" readonly value="0"></td>
                <td></td>
                <td class="no-print"></td>
            </tr>
        </tfoot>
    </table>

    <div class="terms-section">
        <p><strong>èªªæ˜:</strong></p>
        <p>1. æœ¬å ±åƒ¹å–®æœ‰æ•ˆæ—¥æœŸ: 1å€‹æœˆå…§</p>
        <p>2. æœ¬å ±åƒ¹ä¸å«ç‡Ÿæ¥­ç¨…</p>
        <p>3. æœ¬å ±åƒ¹å«äº¤é€šè²»åŠä½å®¿è²»</p>
        <p>4. è¨‚è²¨äº¤æœŸ: ç´„15æ—¥</p>
        <p>5. å¦‚æ¬²è¨‚è³¼è«‹ç°½åå›å‚³ç¢ºèª</p>
    </div>

    <div class="footer-sign">
        <div class="sign-box">
            <span>å®¢æˆ¶ç°½å:</span>
            <img id="signature-display" class="sign-img" style="display:none;" />
            <div class="no-print">
                <canvas id="signature-pad" width="300" height="100"></canvas>
                <br>
                <button type="button" class="clear-sign" onclick="clearSignature()" style="margin-top:5px; font-size:12px; padding: 5px;">æ¸…é™¤é‡ç°½</button>
            </div>
        </div>
        
        <div class="sign-box">
            æ‰¿è¾¦äºº: <input type="text" value="" placeholder="è¼¸å…¥æ‰¿è¾¦äºº" style="display:inline; width: 60%; border:none;">
        </div>
    </div>
</div>

<script>
    // åˆå§‹åŒ–æ—¥æœŸ 
    const today = new Date();
    const year = today.getFullYear() - 1911; // æ°‘åœ‹å¹´
    document.getElementById('dateField').value = `${year}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;

    // ç°½åæ¿åŠŸèƒ½
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;

    // æ”¯æ´æ»‘é¼ èˆ‡è§¸æ§
    function getPos(canvas, evt) {
        const rect = canvas.getBoundingClientRect();
        const x = (evt.clientX || evt.touches[0].clientX) - rect.left;
        const y = (evt.clientY || evt.touches[0].clientY) - rect.top;
        return { x, y };
    }

    // é–‹å§‹ç•«
    const startDraw = (e) => {
        e.preventDefault();
        isDrawing = true;
        const pos = getPos(canvas, e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    };

    // ç•«åœ–ä¸­
    const draw = (e) => {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPos(canvas, e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
    };

    // çµæŸç•«åœ–
    const endDraw = () => { isDrawing = false; };

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', endDraw);

    function clearSignature() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('signature-display').src = "";
    }

    // è‡ªå‹•è¨ˆç®—åŠŸèƒ½ 
    function calcTotal(element) {
        const row = element.closest('tr');
        const qty = parseFloat(row.querySelector('.qty').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        const total = qty * price;
        row.querySelector('.total').value = Math.round(total);
        calcGrandTotal();
    }

    function calcGrandTotal() {
        let sum = 0;
        document.querySelectorAll('.total').forEach(el => {
            sum += parseFloat(el.value) || 0;
        });
        document.getElementById('grandTotal').value = sum;
    }

    // æ–°å¢åˆ—
    function addRow() {
        const tbody = document.querySelector('#quoteTable tbody');
        const rowCount = tbody.rows.length + 1;
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${rowCount}</td>
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="number" class="qty" value="1" oninput="calcTotal(this)"></td>
            <td><input type="number" class="price" placeholder="0" oninput="calcTotal(this)"></td>
            <td><input type="text" class="total" readonly value="0"></td>
            <td><input type="text"></td>
            <td class="no-print"><button class="delete-btn" onclick="deleteRow(this)">åˆª</button></td>
        `;
        tbody.appendChild(tr);
    }

    // åˆªé™¤åˆ—
    function deleteRow(btn) {
        const row = btn.closest('tr');
        row.remove();
        // é‡æ–°ç·¨è™Ÿ
        const rows = document.querySelectorAll('#quoteTable tbody tr');
        rows.forEach((r, index) => {
            r.cells[0].innerText = index + 1;
        });
        calcGrandTotal();
    }

    // åˆ—å°/è½‰PDF åŠŸèƒ½
    function printPDF() {
        // 1. æŠŠç°½åæ¿çš„å…§å®¹è½‰æˆåœ–ç‰‡ï¼Œé€™æ¨£åˆ—å°æ™‚æ‰çœ‹å¾—åˆ°
        const dataUrl = canvas.toDataURL();
        // åªæœ‰ç•¶æœ‰ç°½åæ™‚æ‰è¨­å®šåœ–ç‰‡
        // ç°¡å–®åˆ¤æ–·ç•«å¸ƒæ˜¯å¦ç‚ºç©ºï¼ˆé€™è£¡ç°¡å–®è™•ç†ï¼Œåªè¦æŒ‰åˆ—å°å°±è½‰åœ–ï¼‰
        document.getElementById('signature-display').src = dataUrl;

        // 2. å‘¼å«ç€è¦½å™¨åˆ—å°
        window.print();
    }
</script>

</body>
</html>